default:
  image:
    repository: ghcr.io/streamx-com/streamx-blueprints
    tag: latest-jvm

sources:
  pages-source:
    outgoing:
      - ref: "inbox.pages"
        produces:
          - "com.streamx.blueprints.page.published.v1"
          - "com.streamx.blueprints.page.unpublished.v1"

descriptors:
  web-server-sink:
    type: "edge"
    incoming:
      resources:
        binding: "http-structured-json"

ingestion:
  rest-ingestion:
    containers:
      - environment:
          QUARKUS_HTTP_AUTH_PERMISSION_BEARER_POLICY: permit

processing:
  pages-relay:
    containers:
      - incoming:
          incoming-pages:
            ref: inbox.pages
        outgoing:
          outgoing-pages:
            ref: outbox.pages
        environment:
          STREAMX_PROXY_CONFIG_RELAY_ENABLED: "true"

edge:
  blueprint-web-server-sink:
    containers:
      - image: web-server-sink
        incoming:
          resources:
            ref: outbox.pages
        ports:
          - "8081:8080"
        environment:
          STREAMX_DELIVERY_SERVICE_READINESS_CHECK_ENABLED: "false"